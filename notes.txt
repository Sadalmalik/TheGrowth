События:
- (done) Карта положена
- (done) Карта перевернута
- (done) На карту положили
- (done) С карты сняли карту
- (done) Ход игры

Команды:
- (done) FlipCard
- (done) MoveCard
- (done) Сдвинуть камеру
- (done) IterateCards
- ~~~~~~ Пустить эффект
- (done) Убрать карту в руку
- (done) Убрать карту в колоду
- ~~~~~~ Удалить карту
- (done) Применить ко всем (картам/слотам)
- (done) Завершени матча
  - (done) Победа
  - (done) Порадение
- (done) Изменить заряды
  - (done) потратить
  - (done) добавить

Проверки:
- (done) Чем является карта?
  - Нужно задавать списки карт
- (done) Проверка числа зарядов

Эвалуаторы:
- (done) Эвалуаторы ячеек
- (done) Эвалуаторы карт на поле
- (done) CoverCard
- (done) CardUnder
- (done) PlayerCard
- (done) ActiveCard
- (done) IteratingCard
- (done) TrashSlot
- (done) LootSlot
- (done) Слоты руки (список)


------------------------------------------------------------


Подумать о тумане

Новые задачи:
- Сделать логику руки:
  - Выдавать карту героя
  - Выдавать стартовый набор карт абилок
  - Принуждать первый ход быть ходом игрока
- Сделать что бы нельзя было таскать НЕ свои карты
- (done) Сделать преслеедование
- Механизм управления начальным спавном



------------------------------------------------------------



Черновик документации.

Гайды.
Гайд - это короткий документ-инструкция, описывыющий как решат одну конкретную задачу.

Как писать гайды?
Гайд должен писаться по тем же принципам, по которым пишется код - KISS и SOLID.
В чем тут идея? Согласно первому принципу S(OLID) любая сущность должна решать ровно одну задачу.
В коде сущностью является класс. В документациии сущностью является один отдельный документ.



Архитектура проекта
- Есть конфииги и есть сцены
  И то и другое - это статичные данные, пресеты
- Есть система энтитей (Entity) и персистентный стейт игры.
  Это динамические данные.
  Они умеют сохранятся/загружаться и имеют всякую логику.
  - На базе абстрактных энтитей мы строим игру.
    Энтити могут иметь на себе вьюхи, если они им требуются.
    Сохраняемые менеджеры/сущностии так же наследуем от энтити.
    То есть например иинвентарь - это тоже энтити. Он хранит в себе список энтитей-предметов.
  - Конфиг, описывающий энтити называется Модель (Model)
- Есть история, она разбита на шаги.
  - Шаг - отдельный конфиг, описывающий:
    - как в данный момент должна функционировать игра
	- какие диалоги должны быть доступны
	- какеие квесты актиывны
	- какие условия завершения данного шага
	  и так далее



------------------------------------------------------------



- Есть журнал
  - В журнале есть список заметок
  - В журнале есть список активных целей
- Есть персонаж
  - У персонажа есть Имя, описание, лицо
  - Есть список общих реплик
  - Дефолтные диалоги
- Система локализации
  В редакторе ID ставятся руками
  - Поковырять Streaming Assets - минус, можно просто грузить с гугл таблицы
  - Поковырять гугл-таблицы для диалогов
  - Поковырять гугл-таблицы для прочих текстов


- Как стартуют диалоги?
  Точки входа в диалоги
  - Хаб диалогов (гостинная)
    тут Можно выбрать персонажа
    - Он скажет рандомную реплику
    - У игрока будет набор выборов, каждый из которых запускает диалог
      - Диалоги определяются текущим шагом игры
	  - Диалоги могут бытф одноразовые и многоразовые
  - Триггеры
    - Вход на определенный экран
    - Получение определенного предмета
    - Завершение определенного квеста
    - Событие в кспедиции (команда запуска диалога)





Что я хочу от ГД
- Составить набор параметров сценарного шага (выдача диалогов, квестов, что настраивать и как)
- Описание ветвлений игры (условия)
- Описание какие еще механики хочется настраивать в Шаге истории





StoryStep
- Экшены старта
- Таймаут
- Ожидание/Основная логика
- Экшены выхода
- Компоненты
  - Например задать бэкграунд локации
  - Задать доступные диалогу

Условия завершения:
- Таймер
- Скип тултипа + таймер
- Кондишн
  - Завершение диалога
  - Выполнение крафта




Экран с текстом и кнопкой скип



Что сделать:
- Инвентарь в Хабе - основной инвентарь с которым мы работаем
- Колода - инвентарь локации, из которого берутся карты
- Сброс - второй инвентарь локации, куда сбрасываются карты, которые мы не собираем
- Рука игрока - небольшой временный инвентарь с нашими картами
- Рюкзак - небольшой временный инвентарь, куда складываются собранные карты



События на столе
- Карты из колоды раскладываются
- Игрок перетаскивает карты
- Выполняется итерация остальных карт (шаг игры)

- Экран выбора локации
- Экран победа/поражения
-



1920/1080 = 2048/1153
x = 1080 * 2048/1153



+ OnPlaced
+ OnPlacedFirstTime
+ OnFlipped
- OnStep
+ OnCover
+ OnUnCover









HUD экспедиции



Ходы
+ Задаем в конфиги локации
  + Ходы исчерпались - гамовер
+ Гейм-экшены на добавление и трату ходов
+ Кондишен/Эвалуатор на число ходов

+ Перемещение карт в специальные слоты:
  + Рука
  + Рюкзак
  + Колода

- Гейм-экшен завершения экспедиции

Победа:
- Собранные ресурсы получаем в инвентарь
- Все не потраченные абилки возвращаем в инвентарь

Поражение:
- Теряем собранные ресурсы
- Если монстр съел
  - То теряем абилки из руки
  - То персонаж получает ранение (пока не делаем)


-------------------------------------------------------------------------
RENEMARO:

- доработка колоды
	- сделать карты которые не выпадают при первой раскладке
	- сделать команду\эвалуатор для выбора карты из колоды
- защита от дурака
	- нельзя начать экспедицию не выбрав персонажа
+ текущий билд: ход заканчивается если положить карту персонажа на ее текущую позицию
	- сделать чтобы ходл не заканчивался
	- (вопрос к ГД - хотим ли мы чтобы игрок мог пропустить ход?)
+ как отменить применение абилки? (я взял абилку из слота абилки но передумал ее применять)
	- ПКМ отменяет абилку, карта абилки возвращается в свой слот
- предоставлиние игроку обзора карты (либо один из 2х вариантов, либо оба варианта)
	- перемещение камеры по карте
		- удерживанием ПКМ
		- камера двигается за курсором пока игрок удерживает ПКМ
		- камера возвращается к карте персонажа как только игрок отпускает клавишу переджвижения камеры
	- зум
		- колесико вверх -> камера отдаляется на макс расстояние и дает вид на всю карту
		- колесико вниз плавно возвращает камеру к карте персонажа
		- ЛИБО игрок может плавно отдалять и приближать камеру колесом мыши (РТС стайл)
+ БАГ -карту персонажа можно положить в любое место 

- разделить зум и отмену абилки (сейчас обе на ПКМ)
- команда изменения кол-ва ходов (например через чарджи)
- прозрачность для оближки карт в covered состоянии (визуально должны выглядеть https://miro.com/app/board/o9J_k0nZLO4=/?moveToWidget=3458764640464800257&cot=14 )
- БАГ(?) - скилл Vision выбирается на этапе подготовки но не отображается в игре
- БАГ - при раздаче на стол в 96 слотов из деки в 96 карт на столе появляются 3-5 пустых слотов
- БАГ - Карта абилки после возврата в руку ложится сверху на первый слот, закрывая другую абилку
- БАГ - Карта абилки кладется в пустой слот
- Sound - добавить опцию "проиграть звук" в инстпекторе (доп настройки не нужны для текущей версии)
- БАГ - монстр заспавнился на карте выхода (надо добавить special карты в исключения для спавна, как сейчас сделано с монстрами)
- БАГ - после возвращения в Хаб из экспедиции выбранные карты (персонаж + скилы) га экране экспедиции остаются, что очень удобно! Но при входе в карточную игру карты перса и скилов не переварачиваются. 




UIInventory
- Отображает набор айтемов из инвентаря
- Может фильтровать по
  - Группе айтемов
  - Наличию/отсутствию слота
  - Другим параметрам

UISlot
- Отображает ОДИН айтем из инвентаря
- Выбирает по SlotID









Меню крафта содержит три вкладки:
Вкладка 1: сюжетный мега-крафт (возможно с выбором крафта в будущем)
Вкладка 2: меню выбора крафтов и крафты
Вкладка 3: инвентарь

Интерфейс крафта:
Каждая ячейка имеет фиксированный предмет
и показывает сколько надо И сколько у нас реально есть в инвентаре

Сложный крафт - идентичен простому

На одном интерфейсе может быть несколько крафтов

Удерживаемые кнопки




Список крафтов

Команды крафтов:
+ Задать Проект
+ Добавить Крафт
+ Убрать Крафт






Что нужно еще сделать:
- Сделать связку что бы кнопка крафта сама настраивала слоты крафта (отображала)
  Это нужно для того что бы настройка крафта была в одном месте
- Возможно почитстить код?












Story Line и Story Block

Story Line - это собственно цепочка всего сюжета истории
Story Block - это отдельный шаг сюжета, который характеризует определенное состояние игры на данном этапе истории.


Что нужно проработать:
- Как мы завершаем шаги:
  - Таймаут - НЕ ДЕЛАЕМ
  - Триггеры - какие?
    Устройство триггеров:
	Есть эвент
    - Выполнился крафта: Что за айтем  -- Готово
	- Мы вошли в Хаб  -- Готово с комнатами
	- Мы вошли в Экспедицию
	- Мы завершили Экспедицию: успех/фейл
	- Мы собрали айтем в экспедиции: что за айтем
	Есть кондишены
	- Проверка наличия и колличества айтема
	- Проверка отношений с НПС (при входе в HUB)
- Как мы выбираем следующий шаг?
  Вариант 1: смена шага происходит явной командой (можно случайно сделать луп)
  Вариант 2: когда шаг завершается - у него есть список следующих шагов и у каждого шага есть условия. Запускается тот, чьи условия выполнены
.


Надо подумать:
- чего еще не хватает?
- Туториальные шаги - как они устроены? что они показывают?
	- всплывающее изображение с описанием, закрывается кнопкой (туториалы в Drakest Dungeon)
- Что будет если шаг завершился, и ни один из следующих за ним НЕ может стартовать?
  - Вариант решения: ответственность ГД, переход на дефолтный шаг
- Что будет если шаг завершился, и НЕСКОЛЬКО из следующих за ним хотят стартовать?
  - Вариант решения: по порядку - кто первый встал того и тапки
- Что делать, если игрок принес из экспедиции 2 квестовые вещи одновременно?


Если делать по порядку, то можно сделать что последний вариант всегда работает, таким образом все работает.











Про диалоги.

Самое важное - формат диалога.
Потому что это штука, с которой так или иначе работают сразу ТРИ разных исполнителя:
- Писатель
- Переводчик
- Движок
Каждый может быть отдельным инструментом.

В ряде случаев формат зависит от готовых инструментов, от которых придется отталкиваться.
Технически есть три варианта:
- Текст
- Таблица
- Граф Нодов (это может быть JSON, может быть что-то еще)

Соответственно все инструменты в пайплайне должны уметь переваривать выбранный формат.
И если какой-то инструмент не умеет - под него придется писать конвертер.

Соответственно, есть несколько путей работы с диалогами:
- Текст с определенными правилами форматирования и тегами (ink/inkle, кастомные форматы)
  Кажется просто, но не просто - ink целиком со своим плагином и никто кроме него парсить его не умеет. С локализацией не дружит - надо буквально переписывать диалог заново на другом языке.
- Гугл-таблица вида N строк = реплика/действие/выбор/прочее
  Таблицы хороши для переводчиков.
  Для писателей таблица может оказаться крайне неудобной ЕСЛИ:
  - В истории МНОГО ветвлений - десятки/сотни, глубокие ветвления (за одним выбором еще 3, за каждым еще по 5), есть пересекающиеся ветки
  - Диалоги имеют много уникального функционала
    например помимо простой реплики есть QTE, есть выбор, есть магази, есть фотостудия, есть миниигры аля вскрытие замка
	если подобных штук много - то становится сложно сделать удобный формат таблицы, тем более в сочетании с ветвлениями
- Редактор в виде дерева диалога (как дерево папок)
  Пример: https://assetstore.unity.com/packages/tools/gui/dialogue-2-game-creator-2-218635
  Такое можно напилить в инспекторе самому, выглядит приятно.
  - Нет проблем иметь много 
- Нодовый редактор где каждая реплика - отдельный блок и они соединены стрелками.
  Пример 1: https://www.articy.com/en/
  Пример 2: https://assetstore.unity.com/packages/tools/behavior-ai/vide-dialogues-69932
  Такое пилить долго и сложно.
  Формат требует тулзов для Переводчиков и Движка.
  НО.
  - Очень хорошая наглядность
  - Просто делать пересекающиеся ветки


UI для диалогов надо писать во всех случаях кроме взятия каких-то готовых систем.
Но в моем понимании UI пишется легко и смысла тащить плагины я не вижу.

Ноды в диалогах по частоте:
- Реплика
- Выбор
- Переход к реплике (это если формат НЕ нодовый)
- QTE выбор (с таймером и дефолтным выбором)
- Миниигры. Каждая - уникальный нод.
- Хоровая реплика (реплика у которой просто несколько персонажей и игроку это отображается)


Вопрос в том, что нам нужно?
Какие критерии выбора:
- Колличество текста в целом: чем больше текста надо просто писать - тем проще должно быть его писать и соответственно проще формат
- Колличество ветвлений: чем больше ветвлений - тем сложнее должен быть формат
- Какие предпочтения по инструментам?
- Какие есть особые ноды? (Если есть)








Naninovel
Нужно написать:
- Биндинги для передачи переменных в обе стороны
- Команду для вызова наших команд из диалога
- Команду вызова диалога из наших скриптов



Сделать кондишен на айтемы







10.2.2026
Отображать на карте кол-во зарядов
+ вкл. выкл
+ отображение в одном месте
Эвалуатор кол-ва определенных карт в инвентаре
Включить прокликивание мышкой диалоги
Управление камерой:
+ подводишь мышкой к краю экрана - камера двигается